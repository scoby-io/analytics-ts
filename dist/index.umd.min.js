/*!
 * @scoby/analytics-ts v2.0.0
 * (c) Scoby UG
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("got"),require("build-url-ts"),require("crypto"),require("ip-matching")):"function"==typeof define&&define.amd?define(["exports","got","build-url-ts","crypto","ip-matching"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Scoby={},t.got,t.buildUrl,t.crypto,t.ipMatching)}(this,(function(t,e,r,i,n){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=o(e),s=o(r);function u(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))}function c(t,e){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var l=function(){function t(t,e){this.apiKey=t,this.salt=e,this.ipBlacklistPatterns=[],this.jarId=this.getJarId(),this.apiHost="https://".concat(this.jarId,".s3y.io")}return t.prototype.hash=function(t){return i.createHmac("sha256",this.salt).update(Buffer.from(t,"utf-8")).digest("hex")},t.prototype.getVisitorId=function(t){var e=t.visitorId,r=t.ipAddress,i=t.userAgent;return e?this.hash([e,this.jarId].join("|")):this.hash([r,i,this.jarId].join("|"))},t.prototype.getJarId=function(){var t=Buffer.from(this.apiKey,"base64").toString("ascii").split("|");return t.length,t[0]},t.prototype.logPageView=function(t){return u(this,void 0,void 0,(function(){var e,r,i,n,o,u,l,f;return c(this,(function(c){switch(c.label){case 0:return e=t.userAgent,r=t.requestedUrl,i=t.referringUrl,n=t.ipAddress,this.isBlockedIp(n)?[2,!1]:(o={vid:this.getVisitorId(t),ua:e,url:r},i&&(o.ref=i),u=s.default(this.apiHost,{path:"/count",queryParams:o}),l={timeout:{send:5e3},headers:{Authorization:"Bearer ".concat(this.apiKey)}},[4,a.default(u,l).catch((function(t){throw new Error("failed to log page view"+t.message)}))]);case 1:if(204===(f=c.sent().statusCode))return[2,!0];throw new Error("failed to log page view. Status code: "+f)}}))}))},t.prototype.isBlockedIp=function(t){for(var e=0,r=this.ipBlacklistPatterns;e<r.length;e++){var i=r[e];if(n.matches(t,i))return!0}return!1},t.prototype.blacklistIpRange=function(t){this.ipBlacklistPatterns.push(t)},t}();t.Client=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
